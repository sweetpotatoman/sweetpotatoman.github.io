(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{352:function(t,e,a){"use strict";a.r(e);var s=a(9),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v(".dockerignore 可减少文件的传输数量，提升 build 效率")])]),t._v(" "),a("h3",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("p",[a("code",[t._v(".dockerignore")]),t._v(" 文件的作用类似于 "),a("code",[t._v("git")]),t._v(" 工程中的 "),a("code",[t._v(".gitignore")]),t._v("。不同的是 "),a("code",[t._v(".dockerignore")]),t._v(" 应用于 "),a("code",[t._v("docker")]),t._v(" 镜像的构建，它存在于 "),a("code",[t._v("docker")]),t._v(" 构建上下文的根目录，用来排除不需要上传到 "),a("code",[t._v("docker")]),t._v(" 服务端的文件或目录")]),t._v(" "),a("h3",{attrs:{id:"主要作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主要作用"}},[t._v("#")]),t._v(" 主要作用")]),t._v(" "),a("ul",[a("li",[t._v("构建镜像时能避免不需要的大文件上传到服务端，从而拖慢构建的速度、网络带宽的消耗")]),t._v(" "),a("li",[t._v("可以避免构建镜像时将一些敏感文件及其他不需要的文件打包到镜像中，从而提高镜像的安全性")])]),t._v(" "),a("h3",{attrs:{id:"编写方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写方法"}},[t._v("#")]),t._v(" 编写方法")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v(".dockerignore")]),t._v(" 文件的写法和 "),a("code",[t._v(".gitignore")]),t._v(" 类似，支持"),a("strong",[t._v("正则和通配符")]),t._v("，具体规则如下")])]),t._v(" "),a("ul",[a("li",[t._v("每行为一个条目")]),t._v(" "),a("li",[t._v("以 # 开头的行为注释")]),t._v(" "),a("li",[t._v("空行被忽略")]),t._v(" "),a("li",[t._v("构建上下文路径为所有文件的根路径")])]),t._v(" "),a("h4",{attrs:{id:"文件匹配规则具体语法如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件匹配规则具体语法如下"}},[t._v("#")]),t._v(" 文件匹配规则具体语法如下")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("one")]),t._v(" "),a("th",[t._v("two")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("em",[t._v("/temp")])]),t._v(" "),a("td",[t._v("匹配根路径下一级目录下所有以 temp 开头的文件或目录")])]),t._v(" "),a("tr",[a("td",[a("em",[t._v("/")]),t._v("/temp*")]),t._v(" "),a("td",[t._v("匹配根路径下两级目录下所有以 temp 开头的文件或目录")])]),t._v(" "),a("tr",[a("td",[t._v("temp?")]),t._v(" "),a("td",[t._v("匹配根路径下以 temp 开头，任意一个字符结尾的文件或目录")])]),t._v(" "),a("tr",[a("td",[t._v("**/*.go")]),t._v(" "),a("td",[t._v("匹配所有路径下以 .go 结尾的文件或目录，即递归搜索所有路径")])]),t._v(" "),a("tr",[a("td",[t._v("*.md")]),t._v(" "),a("td",[t._v("匹配根路径下所有以 .md 结尾的文件或目录")])]),t._v(" "),a("tr",[a("td",[t._v("!README.md")]),t._v(" "),a("td",[t._v("README.md 除外")])])])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("如果两个匹配语法规则有包含或者重叠关系，那么以后面的匹配规则为准")]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("*.md\n!README.md\n")])])]),t._v("除了 "),a("code",[t._v("README.md")]),t._v(" 外，一起的 "),a("code",[t._v(".md")]),t._v(" 文件都被忽略")])]),t._v(" "),a("h3",{attrs:{id:"node-案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-案例"}},[t._v("#")]),t._v(" node 案例")]),t._v(" "),a("ul",[a("li",[a("p",[t._v(".dockerignore")]),t._v(" "),a("div",{staticClass:"language-.dockerignore extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(".git\n_DStore\nnode_modules\nscript\nstatic\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Dockerfile")]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . /app/node\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /app/node\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" npm install\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8081\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("使用 "),a("code",[t._v(".dockerignore")]),t._v(" 前后上传到 docker 服务端的构建上下文大小对比：\n使用前 "),a("code",[t._v("(73.36MB)")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ docker build -t tool:5.0 -f Dockerfile-frontend-tool .\nSending build context to Docker daemon  73.36MB\nStep 1/6 : FROM node:8-alpine\n")])])])]),t._v(" "),a("li",[a("p",[t._v("使用后 "),a("code",[t._v("(11.38MB)")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ docker build -t tool:6.0 -f Dockerfile-frontend-tool .\nSending build context to Docker daemon  11.38MB\nStep 1/6 : FROM node:8-alpine\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#link"}},[t._v("#")]),t._v(" link")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.xuxusheng.com/post/docker-build%E5%91%BD%E4%BB%A4%E5%90%8E-%E5%8F%B7%E7%9A%84%E6%84%8F%E6%80%9D",target:"_blank",rel:"noopener noreferrer"}},[t._v("镜像构建上下文 - context "),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=r.exports}}]);